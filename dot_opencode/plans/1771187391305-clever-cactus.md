# Plan: Block All Access to /tmp Using external_directory Permissions

## Problem Statement
Multiple OpenCode instances running simultaneously can cause file collisions in /tmp:
- Two agents might write to the same filename
- An agent might read a file written by another instance, thinking it's their own
- This creates unpredictable behavior and potential data corruption

## Solution
Use `external_directory` permission to completely block ALL access to /tmp.

## Changes Required

### File: `/Users/katherinemasseau/.config/opencode/opencode.json`

Add `external_directory` permission configuration:

```json
"external_directory": {
  "*": "ask",
  "/tmp/**": "deny"
}
```

This configuration:
1. Maintains default behavior of asking for external directories (`"*": "ask"`)
2. Explicitly denies ANY access to /tmp paths (`"/tmp/**": "deny"`)
3. Last matching rule wins, so /tmp paths are denied

## Why This Is Better Than `edit` Permission

| Aspect | `edit` approach | `external_directory` approach |
|--------|----------------|------------------------------|
| Blocks writes to /tmp | ✅ Yes | ✅ Yes |
| Blocks reads from /tmp | ❌ No | ✅ Yes |
| Blocks bash commands in /tmp | ❌ No | ✅ Yes |
| Blocks listings of /tmp | ❌ No | ✅ Yes |
| Prevents file collisions | ⚠️ Partial | ✅ Complete |

## Security Benefits

1. **Complete isolation**: Models cannot access /tmp at all
2. **No collision risk**: Eliminates filename conflicts across instances
3. **Clear boundaries**: Forces models to use project directories or other designated temp locations
4. **Predictable behavior**: Each instance stays in its own workspace

## Verification

After implementation:
1. Any attempt to read/write/list /tmp will be denied
2. Models will be forced to use project directories for temp files
3. Multiple instances can run without /tmp conflicts

## Alternative Approaches Considered

- **Using `edit` only**: Would prevent writes but still allow reads, not solving the collision problem
- **Using agent-specific temp directories**: More complex, requires code changes
- **Mounting tmpfs per instance**: System-level solution, overkill for this use case

The `external_directory` approach is the cleanest, simplest solution.
